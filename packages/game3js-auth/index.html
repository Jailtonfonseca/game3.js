<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset='utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1'>

    <title>OP Arcade SDK Example</title>

    <!-- load the compiled library -->
    <script defer src='/dist/game3js-auth.js'></script>
</head>

<!-- a script to help with updating ui components -->    
<script> 
function Binding(b) {
    _this = this
    this.elementBindings = []
    this.value = b.object[b.property]
    this.valueGetter = function(){
        return _this.value;
    }
    this.valueSetter = function(val){
        _this.value = val
        for (var i = 0; i < _this.elementBindings.length; i++) {
            var binding=_this.elementBindings[i]
            binding.element[binding.attribute] = val
        }
    }
    this.addBinding = function(element, attribute, event){
        var binding = {
            element: element,
            attribute: attribute
        }
        if (event){
            element.addEventListener(event, function(event){
                _this.valueSetter(element[attribute]);
            })
            binding.event = event
        }       
        this.elementBindings.push(binding)
        element[attribute] = _this.value
        return _this
    }

    Object.defineProperty(b.object, b.property, {
        get: this.valueGetter,
        set: this.valueSetter
    }); 

    b.object[b.property] = this.value;
}
</script>


<script>
    let authStore, loginState;

	let loginDetails = {
    username: "johnny@silverhand.com",
    password: "samurai"
	}

    async function initialize() {

        authStore = await G3JSAuth.init();

        var sdkStateLabel = document.getElementById('sdkStateLabel');

        // bind the sdkState to the UI element
        new Binding(
            {
                object: authStore,
                property: "sdkState"
            })
            .addBinding(sdkStateLabel, "innerHTML");

        var sdkState = authStore.sdkState;


        if (sdkState == G3JSAuth.CONSTANTS.SDK_STATES.INITIALIZED)
        {
            document.getElementById('initButton').disabled = true;
            document.getElementById('loginButton').disabled = false;
        }
    }

    async function login() {
        loginState = authStore.connect();

        var loginStateLabel = document.getElementById('loginStateLabel');
        loginStateLabel.innerHTML = loginState;
    }

    
</script>

<body>
    <p>SDK STATE: </p>
    <p id="sdkStateLabel">waiting for initialize</p>
    <br/>
    <p>LOGIN STATE: </p>
    <p id="loginStateLabel">waiting for initialize</p>
    <br/>

    <button id="initButton" onclick="initialize()">INITIALIZE game3js-auth</button>
    <button id="loginButton" disabled onclick="login()">LOGIN</button>
    <button id="logoutButton" disabled onclick="logout()">LOGOUT</button>
    
</body>
</html>
